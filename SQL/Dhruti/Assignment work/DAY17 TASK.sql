use assignment1

CREATE TABLE Deposit

(  ACTNO VARCHAR(5) NOT NULL,
   Cname VARCHAR(18) NOT NULL,
   Bname VARCHAR(18) NOT NULL,
   Amount int NOT NULL,
   Adate DATE NOT NULL,
   
);
INSERT INTO Deposit(ACTNO,CNAME,BNAME,AMOUNT,ADATE) VALUES(100,'ANIL','VRCE',1000.00,'1-MAR-95');
INSERT INTO Deposit(ACTNO,CNAME,BNAME,AMOUNT,ADATE) VALUES(101,'SUNIL','AJNI',5000.00,'4-JAN-96');
INSERT INTO Deposit(ACTNO,CNAME,BNAME,AMOUNT,ADATE) VALUES(102,'MEHUL','KAROLBAGH',3500.00,'17-NOV-95');
INSERT INTO Deposit(ACTNO,CNAME,BNAME,AMOUNT,ADATE) VALUES(104,'MADHURI','CHANDI',1200.00,'17-DEC-95');
INSERT INTO DEPOSIT (ACTNO,CNAME,BNAME,AMOUNT,ADATE) VALUES(105,'PRAMOD','M.G.ROAD',3000.00,'27-MAR-96');
INSERT INTO DEPOSIT (ACTNO,CNAME,BNAME,AMOUNT,ADATE) VALUES(106,'SANDIP','ANDHERI',2000.00,'31-MAR-96');
INSERT INTO DEPOSIT (ACTNO,CNAME,BNAME,AMOUNT,ADATE) VALUES(107,'SHIVANI','VIRAR',1000.00,'5-SEP-95');
INSERT INTO DEPOSIT (ACTNO,CNAME,BNAME,AMOUNT,ADATE) VALUES(108,'KRANTI','NEHRU PLACE',5000.00,'2-JUL-95');
INSERT INTO DEPOSIT (ACTNO,CNAME,BNAME,AMOUNT,ADATE) VALUES(109,'MINU','POWAI',7000.00,'10-AUG-95');



CREATE TABLE BRANCH
(
   Bname VARCHAR(18) NOT NULL,
   CITY VARCHAR(18) NOT NULL,
   
);
INSERT INTO BRANCH (BNAME,CITY) VALUES('VRCE','NAGPUR');
INSERT INTO BRANCH (BNAME,CITY) VALUES('AJNI','NAGPUR');
INSERT INTO BRANCH (BNAME,CITY) VALUES('KAROLBAGH','DELHI');
INSERT INTO BRANCH (BNAME,CITY) VALUES('CHANDI','DELHI');
INSERT INTO BRANCH (BNAME,CITY) VALUES('M.G.ROAD','BANGLORE');
INSERT INTO BRANCH (BNAME,CITY) VALUES('ANDHERI','BOMBAY');
INSERT INTO BRANCH (BNAME,CITY) VALUES('VIRAR','BOMBAY');
INSERT INTO BRANCH (BNAME,CITY) VALUES('NEHRU PLACE','DELHI');
INSERT INTO BRANCH (BNAME,CITY) VALUES('POWAI','BOMBAY');


CREATE TABLE CUSTOMER
(
   Cname VARCHAR(19) NOT NULL,
   CITY VARCHAR(18) NOT NULL,
   
);
INSERT INTO CUSTOMER (CNAME,CITY) VALUES('ANIL','CALCUTTA');
INSERT INTO CUSTOMER (CNAME,CITY) VALUES('SUNIL','DELHI');
INSERT INTO CUSTOMER (CNAME,CITY) VALUES('MEHUL','BARODA');
INSERT INTO CUSTOMER (CNAME,CITY) VALUES('MANDAR','PATNA');
INSERT INTO CUSTOMER (CNAME,CITY) VALUES('MADHURI','NAGPUR');
INSERT INTO CUSTOMER (CNAME,CITY) VALUES('PRAMOD','NAGPUR');
INSERT INTO CUSTOMER (CNAME,CITY) VALUES('SANDIP','SURAT');
INSERT INTO CUSTOMER (CNAME,CITY) VALUES('SHIVANI','BOMABY');
INSERT INTO CUSTOMER (CNAME,CITY) VALUES('KRANTI','BOMBAY');
INSERT INTO CUSTOMER (CNAME,CITY) VALUES('NAREN','BOMBAY');


CREATE TABLE BORROW

(  
   LOANNO VARCHAR(5) NOT NULL,
   CNAME VARCHAR(18) NOT NULL,
   BNAME VARCHAR(18) NOT NULL,
   Amount int NOT NULL,
   
);
INSERT INTO BORROW (LOANNO,CNAME,BNAME,AMOUNT) VALUES(201,'ANIL','VRCE',1000.00);
INSERT INTO BORROW (LOANNO,CNAME,BNAME,AMOUNT) VALUES(206,'MEHUL','AJNI',5000.00);
INSERT INTO BORROW (LOANNO,CNAME,BNAME,AMOUNT) VALUES(311,'SUNIL','DHARAMPETH',3000.00);
INSERT INTO BORROW (LOANNO,CNAME,BNAME,AMOUNT) VALUES(321,'MADHURI','ANDHERI',2000.00);
INSERT INTO BORROW (LOANNO,CNAME,BNAME,AMOUNT) VALUES(375,'PRAMOD','VIRAR',8000.00);
INSERT INTO BORROW (LOANNO,CNAME,BNAME,AMOUNT) VALUES(481,'KRANTI','NEHRU PLACE',3000.00);



--Q1 List Names of Customers who are Depositors and have Same Branch City as that of SUNIL
SELECT CNAME FROM DEPOSIT 
 WHERE BNAME IN (SELECT BNAME FROM BRANCH WHERE CITY=(
 SELECT CITY FROM BRANCH WHERE BNAME=(SELECT BNAME FROM DEPOSIT WHERE CNAME='SUNIL')))


--Q2: List All the Depositors Having Depositors Having Deposit in All the Branches
-- where SUNIL is Having Account
SELECT a.CNAME FROM Deposit a WHERE a.BNAME IN (SELECT b.BNAME FROM 
Deposit b WHERE b.CNAME = 'SUNIL' );


--Q3: List the Names of Customers Living in the City where the Maximum Number of Depositors are Located
--SELECT a.CNAME FROM Depositss a JOIN CUSTOMER b ON  a.Cname  = b.Cname WHERE b.CITY IN

(SELECT * INTO TMP FROM (SELECT COUNT(B.CITY) [DEPOSIT_COUNT],CITY FROM BRANCH B JOIN DEPOSIT D ON D.BNAME=B.BNAME GROUP BY B.CITY)abc)
SELECT * FROM TMP ORDER BY DEPOSIT_COUNT DESC
SELECT CITY FROM TMP WHERE DEPOSIT_COUNT = (SELECT MAX(DEPOSIT_COUNT) FROM TMP)

--Q4: List Names of Borrowers Having Deposit Amount Greater than 1000 and Loan Amount Greater than 2000

SELECT D.CNAME FROM DEPOSIT D JOIN BORROW B 
ON D.CNAME=B.CNAME
WHERE D.AMOUNT>1000 AND B.AMOUNT>2000

--Q5: List All the Customers Living in NAGPUR and Having the Branch City as MUMBAI or DELHI
SELECT a.Cname FROM CUSTOMER a JOIN Deposit b ON a.Cname = b.Cname JOIN BRANCH c ON b.Bname = c.Bname
WHERE a.CITY = 'NAGPUR' AND c.CITY IN ('MUMBAI','DELHI')


--Q6: Count the Number of Customers Living in the City where Branch is Located 
SELECT COUNT(a.Cname) FROM CUSTOMER a JOIN BRANCH b ON a.CITY = b.CITY 

    
SELECT City
    ,    COUNT(CName) AS 'Total'
FROM CUSTOMER
WHERE City IN (
    SELECT City 
    FROM BRANCH
    GROUP BY City
)
GROUP BY City

SELECT City 
    ,    Total =  (
        SELECT COUNT(CName)
        FROM CUSTOMER
        WHERE City = B.City
        GROUP BY City
        )
FROM BRANCH AS B
GROUP BY City 
 



