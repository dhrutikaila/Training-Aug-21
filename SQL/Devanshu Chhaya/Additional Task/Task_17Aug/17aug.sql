
USE AUG17

CREATE TABLE Deposite(
	ACTNO VARCHAR (5) PRIMARY KEY,
	Cname VARCHAR(19) CONSTRAINT FK_1 FOREIGN KEY (CNAME) REFERENCES CUSTOMER(CNAME),
	Bname VARCHAR(18) CONSTRAINT FK_2 FOREIGN KEY (BNAME) REFERENCES BRANCH (BNAME),
	Amount INT,
	Adate DATE,
)

INSERT INTO Deposite Values
(100,'ANIL','VRCE',1000,'19950301'),
(101,'SUNIL','AJNI',5000,'19960104'),
(102,'MEHUL','KAROLBAGH',3500,'19951117'),
(104,'MADHURI','CHANDNI',1200,'19951217'),
(105,'PRAMOD','M.G.ROAD',3000,'19960327'),
(106,'SANDIP','ANDHERI',2000,'19960331'),
(107,'SHIVANI','VIRAR',1000,'19950905'),
(108,'KRANTI','NEHRU PLACE',5000,'19950702'),
(109,'NAREN','POWAI',7000,'19950810')

SELECT * FROM Deposite

CREATE TABLE BRANCH(
	BNAME VARCHAR(18) PRIMARY KEY,
	CITY VARCHAR(18)
)

INSERT INTO BRANCH VALUES 
('VRCE', 'NAGPUR'),
('AJNI','NAGPUR'),
('KAROLBAGH','DELHI'),
('CHANDNI','DELHI'),
('DHARAMPETH','NAGPUR'),
('M.G.ROAD','BANGLORE'),
('ANDHERI','MUMBAI'),
('VIRAR','MUMBAI'),
('NEHRU PLACE','DELHI'),
('POWAI','MUMBAI')

SELECT * FROM BRANCH

CREATE TABLE CUSTOMER(
	CNAME VARCHAR(19) PRIMARY KEY,
	CITY VARCHAR(18) 
)

INSERT INTO CUSTOMER VALUES 
('ANIL','KOLKATA'),
('SUNIL','DELHI'),
('MEHUL','BARODA'),
('MANDAR','PATNA'),
('MADHURI','NAGPUR'),
('PRAMOD','NAGPUR'),
('SANDIP','SURAT'),
('SHIVANI','MUMBAI'),
('KRANTI','MUMBAI'),
('NAREN','MUMBAI');

SELECT * FROM CUSTOMER


CREATE TABLE BORROW
(
	LOANNO VARCHAR(5) PRIMARY KEY,
	CNAME VARCHAR(19) CONSTRAINT FK_CNAME FOREIGN KEY (CNAME) REFERENCES CUSTOMER (CNAME),
	BNAME VARCHAR(18) CONSTRAINT FK_BNAME FOREIGN KEY (BNAME) REFERENCES BRANCH (BNAME),
	AMOUNT INT
)

INSERT INTO BORROW VALUES
(201,'ANIL','VRCE',1000),
(206,'MEHUL','AJNI',5000),
(311,'SUNIL','DHARAMPETH',3000),
(321,'MADHURI','ANDHERI',2000),
(375,'PRAMOD','VIRAR',8000),
(481,'KRANTI','NEHRU PLACE',3000)

SELECT * FROM BORROW

---Q1: List Names of Customers who are Depositors and have Same Branch City as that of SUNIL


SELECT D.CNAME FROM DEPOSITE D JOIN CUSTOMER C  ON D.CNAME=C.CNAME 
WHERE D.BNAME IN
(SELECT BNAME FROM BRANCH WHERE CITY = (SELECT B.CITY FROM DEPOSITE D JOIN BRANCH B ON D.BNAME=B.BNAME WHERE D.Cname='Sunil'))

---Q2: List All the Depositors Having Deposit in All the Branches where SUNIL is Having Account

SELECT CNAME FROM Deposite WHERE BNAME=
(SELECT B.BNAME FROM Deposite D JOIN BRANCH B ON D.BNAME=B.BNAME WHERE D.CNAME='SUNIL') OR BNAME=
(SELECT B.BNAME FROM BORROW BR JOIN BRANCH B ON BR.BNAME=B.BNAME WHERE BR.CNAME='SUNIL')

SELECT Cname from Deposite where BNAME = (SELECT BNAME FROM DEPOSITE WHERE CNAME='Sunil')

----Q3:  List the Names of Customers Living in the City where the Maximum Number of Depositors are Located


SELECT CNAME FROM CUSTOMER WHERE CITY IN
(SELECT CITY FROM 
(SELECT TOP 1 COUNT(CITY) CT, C.CITY FROM Deposite D JOIN CUSTOMER C ON C.CNAME=D.Cname GROUP BY CITY ORDER BY CT DESC)TEMP)



-----Q4:  List Names of Borrowers Having Deposit Amount Greater than 1000 and Loan Amount Greater than 2000

SELECT B.CNAME 
FROM Deposite D JOIN BORROW B ON B.CNAME=D.Cname
WHERE D.AMOUNT> 1000 AND B.AMOUNT>2000



------Q5: List All the Customers Living in NAGPUR and Having the Branch City as MUMBAI or DELHI

SELECT D.CNAME FROM CUSTOMER C JOIN Deposite D ON C.CNAME=D.Cname 
WHERE C.CITY='NAGPUR' AND D.BNAME IN( SELECT B.BNAME FROM Deposite D JOIN BRANCH B ON B.BNAME=D.Bname WHERE B.CITY IN('MUMBAI','DELHI'))


-------Q6: Count the Number of Customers Living in the City where Branch is Located


	SELECT COUNT(CITY) AS NumberofCustomer FROM CUSTOMER WHERE CITY IN (SELECT CITY FROM BRANCH)
